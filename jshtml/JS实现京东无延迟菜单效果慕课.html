<!DOCTYPE HTML>
<html>

	<head>
		<title></title>
		<style type="text/css">
			.wrap {
				position: relative;
				width: 220px;
				left: 50px;
				top: 50px;
			}
			
			ul {
				padding: 15px 0;
				/*margin: 9px;*/
				list-style: none;
				background-color: #6c6669;
				color: #FFF1DC;
				/*border-right-width: 0px;*/
			}
			
			li {
				display: block;
				height: 30px;
				line-height: 30px;
				padding-left: 12px;
				cursor: pointer;
				font-size: 14px;
				position: relative;
			}
			
			li.active {
				background-color: #999395;
			}
			
			li span:hover {
				color: #c81623;
			}
			
			.none {
				display: none;
			}
			
			#sub {
				width: 600px;
				position: absolute;
				border: 1px solid #f7f7f7;
				box-shadow: 2px 0 5px rgba(0, 0, 0, .3);
				left: 220px;
				top: 0;
				box-sizing: border-box;
				margin: 0;
				padding: 10px;
			}
			
			.sub_content a {
				font-size: 12px;
				color: #666;
				text-decoration: none;
			}
			
			.sub_content dd a {
				border-left: 1px solid #e0e0e0;
				padding: 0 10px;
				margin: 4px 0;
			}
			
			.sub_content dl {
				overflow: hidden;
			}
			
			.sub_content dt {
				float: left;
				width: 70px;
				font-weight: 700;
				clear: left;
				position: relative;
			}
			
			.sub_content dd {
				float: left;
				margin-left: 5px;
				border-top: 1px solid #EEE;
				margin-bottom: 5px;
			}
			
			.sub_content dt i {
				width: 4px;
				height: 14px;
				font: 400 9px/14px consolas;
				position: absolute;
				right: 5px;
				top: 5px;
			}
		</style>
	</head>

	<body>
		<div class="wrap" id="test">
			<ul>
				<li data-id="a">
					<span>家用电器</span>
				</li>
				<li data-id="b">
					<span>手机 / 运营商 / 数码</span>
				</li>
				<li data-id="c">
					<span>家居 / 家具 / 家装 / 厨具</span>
				</li>
				<li data-id="d">
					<span>男装 / 女装 / 童装 / 内衣</span>
				</li>
				<li data-id="e">
					<span>个护化妆 / 清洁用品 / 宠物</span>
				</li>
				<li data-id="f">
					<span>鞋靴 / 箱包 / 珠宝 / 奢侈品</span>
				</li>
				<li data-id="g">
					<span>运动 / 户外 / 钟表</span>
				</li>
				<li data-id="h">
					<span>汽车 / 汽车用品 </span>
				</li>
			</ul>

			<div id="sub" class="none">
				<div id="a" class="sub_content none">
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">国产品牌</a>
							<a href="#">互联网品牌</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="#">电视<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">合资品牌</a>
							<a href="#">国产品牌</a>
							<a href="#">互联网品牌</a>
						</dd>
					</dl>
				</div>

				<div id="b" class="sub_content none">
					<dl>
						<dt>
							<a href="#">手机<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">手机品牌</a>
							<a href="#">手机品牌</a>
							<a href="#">手机品牌</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="#">手机<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">手机品牌</a>
							<a href="#">手机品牌</a>
							<a href="#">手机品牌</a>
						</dd>
					</dl>
				</div>

				<div id="c" class="sub_content none">
					<dl>
						<dt>
							<a href="#">家居<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">家居品牌</a>
							<a href="#">家居品牌</a>
							<a href="#">家居品牌</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="#">家居<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">家居品牌</a>
							<a href="#">家居品牌</a>
							<a href="#">家居品牌</a>
						</dd>
					</dl>
				</div>

				<div id="d" class="sub_content none">
					<dl>
						<dt>
							<a href="#">男装<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">男装品牌</a>
							<a href="#">男装品牌</a>
							<a href="#">男装品牌</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="#">男装<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">男装品牌</a>
							<a href="#">男装品牌</a>
							<a href="#">男装品牌</a>
						</dd>
					</dl>
				</div>

				<div id="e" class="sub_content none">
					<dl>
						<dt>
							<a href="#">个护化妆<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">个护化妆</a>
							<a href="#">个护化妆</a>
							<a href="#">个护化妆</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="#">个护化妆<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">个护化妆</a>
							<a href="#">个护化妆</a>
							<a href="#">个护化妆</a>
						</dd>
					</dl>
				</div>

				<div id="f" class="sub_content none">
					<dl>
						<dt>
							<a href="#">鞋靴<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">鞋靴</a>
							<a href="#">鞋靴</a>
							<a href="#">鞋靴</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="#">鞋靴<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">鞋靴</a>
							<a href="#">鞋靴</a>
							<a href="#">鞋靴</a>
						</dd>
					</dl>
				</div>

				<div id="g" class="sub_content none">
					<dl>
						<dt>
							<a href="#">运动<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">运动</a>
							<a href="#">运动</a>
							<a href="#">运动</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="#">运动<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">运动</a>
							<a href="#">运动</a>
							<a href="#">运动</a>
						</dd>
					</dl>
				</div>

				<div id="h" class="sub_content none">
					<dl>
						<dt>
							<a href="#">汽车<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">汽车</a>
							<a href="#">汽车</a>
							<a href="#">汽车</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="#">汽车<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">汽车</a>
							<a href="#">汽车</a>
							<a href="#">汽车</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="#">汽车<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">汽车</a>
							<a href="#">汽车</a>
							<a href="#">汽车</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="#">汽车<i>&gt;</i></a>
						</dt>
						<dd>
							<a href="#">汽车</a>
							<a href="#">汽车</a>
							<a href="#">汽车</a>
						</dd>
					</dl>
				</div>

			</div>
		</div>
		<script src="../js/jquery-1.10.2.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				var sub = $('#sub');

				var activeRow = null; //选中的一级菜单
				var activeMenu = null; //选中的二级菜单

				var timer = null;

				var mouseInSub = false; //标记当前鼠标是否在子菜单里面

				sub.on('mouseenter', function(e) { //在子菜单里面
					mouseInSub = true;
				}).on('mouseleave', function(e) { //移出子菜单
					mouseInSub = false;
				});

				var mouseTrack = [];

				var moveHandler = function(e) {
					mouseTrack.push({
						x: e.pageX,
						y: e.pageY
					});

					if(mouseTrack.length > 3) {
						mouseTrack.shift();
					}
				}

				$('#test').on('mouseenter', function(e) { //鼠标划入
					sub.removeClass('none');
					
					$(document).bind('mousemove',moveHandler);
				}).on('mouseleave', function(e) { //鼠标移出
					sub.addClass('none');

					if(activeRow) {
						activeRow.removeClass('active');
						activeRow = null;
					}

					if(activeMenu) {
						activeMenu.addClass('none');
						activeMenu = null;
					}

					$(document).unbind('mousemove', moveHandler);
				}).on('mouseenter', 'li', function(e) { //鼠标划入
					if(!activeRow) {
						activeRow = $(e.target).addClass('active');
						activeMenu = $('#' + activeRow.data('id'));
						activeMenu.removeClass('none');
						return;
					}

					if(timer) {
						clearTimeout(timer);
					}

					//当前坐标
					var currMousePos = mouseTrack[mouseTrack.length - 1];
					//上一次坐标
					var leftCorner = mouseTrack[mouseTrack.length - 2];

					var delay = needDelay(sub, leftCorner, currMousePos);

					if(delay) {
						timer = setTimeout(function() {
							if(mouseInSub) {
								return false;
							}
							if(!activeRow) { //当鼠标已经移出一级菜单会清空，所以直接返回
								return false;
							}
							activeRow.removeClass('active');
							activeMenu.addClass('none');

							activeRow = $(e.target).addClass('active');
							activeMenu = $('#' + activeRow.data('id'));
							activeMenu.removeClass('none');
						}, 300);
					} else {
						var prevActiveRow = activeRow;
						var preActiveMenu = activeMenu;
						
						activeRow = $(e.target);
						activeMenu = $('#' + activeRow.data('id'));
						
						prevActiveRow.removeClass('active');
						preActiveMenu.addClass('none');
						
						activeRow.addClass('active');
						activeMenu.removeClass('none');
					} 

				})

				function sameSign(a, b) {
					return(a ^ b) >= 0;
				}

				function vector(a, b) {
					return {
						x: b.x - a.x,
						y: b.y - a.y
					}
				}

				function vectorProduct(v1, v2) {
					return v1.x * v2.y - v2.x * v1.y;
				}

				function isPointInTrangle(p, a, b, c) {
					var pa = vector(p, a);
					var pb = vector(p, b);
					var pc = vector(p, c);

					var t1 = vectorProduct(pa, pb);
					var t2 = vectorProduct(pb, pc);
					var t3 = vectorProduct(pc, pa);

					return sameSign(t1, t2) && sameSign(t2, t3);
				}

				function needDelay(elem, leftCorner, currMousePos) {
					var offset = elem.offset();

					var topLeft = {
						x: offset.left,
						y: offset.top
					};

					var bottomLeft = {
						x: offset.left,
						y: offset.top + elem.height()
					}

					return isPointInTrangle(currMousePos, leftCorner, topLeft, bottomLeft);
				}
			})
		</script>
	</body>

</html>