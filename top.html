<html>

	<head>
		<meta charset="utf-8">
		<title>Hello APP</title>
	</head>

	<body>
		<button id="btn">请求</button>
		<script src="../script/jquery1.11.1.min.js"></script>
		<script type="text/javascript" src="../script/api.js"></script>
		<script>
			var url = 'http://api.azooo.com/WechatWeb/Test/testLocation';
			//    var url = 'http://azooo.localhost.com/WechatWeb/Test/testLocation';
			var btn = document.getElementById("btn");
			var flag = false;
			var timer = null;
			var method = 'post';
			btn.onclick = function() {
				alert('123123');
				if(!flag) {
					play(url, method);
					flag = true;
				} else {
					clearInterval(timer); 
					falg = false;
				}
			};

			// 每隔3秒请求一次
			function play(url, method) {
				api.startLocation({
					accuracy: '10m',
					filter: 1,
					autoStop: true
				}, function(ret, err) {
					if(ret.status) {
						var lat = ret.latitude;
						var lng = ret.longitude;
						var ajaxData = {};
						ajaxData.lat = lat;
						ajaxData.lng = lng;

						function runin() {
							api.ajax({
								url: url,
								type: method,
								dataType: "json",
								cache: false,
								data: ajaxData
							}, function(ret, err) {

							})

						}
						setInterval(runin, 2000);

					} else {
						api.alert({
							msg: err.msg
						});
					}
				});
			}
		</script>

		<script>
			api.startLocation({
				accuracy: '100m',
				filter: 1,
				autoStop: false //这个参数!
			}, function(ret, err) {
				alert('哈哈哈');
				if(ret.status) {
					var lat = ret.latitude;
					var lon = ret.longitude;
					var time = ret.timestamp;
					var str = '经度：' + lon + '\n';
					str += '纬度：' + lat + '\n';
					str += '更新时间：' + time;
					api.alert({
						msg: str
					});
				} else {
					api.alert({
						msg: err.msg
					});
				}
				alert('哇啊啊啊啊');
			});
		</script>
	</body>

</html>